<?php
 /**
     * @name <%= $className; %>
     *
     * @author AutoGenerated
     * 
     * @abstract This file will handel all the ajax calls from the corrosponding client side javascript object
     * 
     * @package ACM Rebuild
     * @subpackage CMS/Front End
     *
     * @see --none
     *             
     */
require_once("../php/conn.php");
require_once("../php/xDrivers2/xDriverConn.php");


switch($_GET['action']){
	case "loadOne":
		//validate the index
		$isValid = xDriver::validateIndex('<%= $className; %>', '<%= $pKey; %>', $_GET['<%= $pKey; %>']);
		if($isValid){
			//calls the approprate functions to load one  <%= $className; %>
			$obj = <%= tempDriver::capatilize($className); %>::Load($_GET['<%= $pKey; %>']);
			$xml = <%= $className; %>XDriver::toXML($obj);
		}
		
	break;
	case "loadAll":
		//calls the approprate functions to load an array of <%= $className; %>s 
		$objArr = <%= tempDriver::capatilize($className); %>::LoadAll();
		$xml = <%= $className; %>XDriver::arrayToXML($objArr);
	

	break;
	case "saveOne":
		$isValid = xDriver::validateIndex('<%= $className; %>', '<%= $pKey; %>', $_GET['<%= $pKey; %>']);
		if($isValid){
			//calls the approprate functions to save a single <%= $className; %>
			if($_GET['<%= $pKey; %>'] == -1){
				//create new object
				$tObj = new <%= tempDriver::capatilize($className); %>();
			}else{
				$tObj = <%= tempDriver::capatilize($className); %>::Load($_GET['<%= $pKey; %>']);
			}
			<% foreach ($fieldObjs as $field){ %>
				<% if ((!tempDriver::isNativeField($field->name))&&($field->name != $pKey)){ %>
				$tObj-><%= tempDriver::capatilize($field->name); %> = $_GET['<%= $field->name; %>'];<% } %>
			<% } %>
			saveDriver::save($tObj);
			$xml = <%= $className; %>XDriver::toXML($tObj);
		}
	break;
	case "deleteOne":
		//TODO: Insert delete functionlaity
	break;
	<% foreach ($parentFields as $field){ %>
	case "loadArrayBy<%= tempDriver::capatilize($field->name); %>":
		$isValid = xDriver::validateIndex('<%= $className; %>', '<%= $field->name; %>',$_GET['<%= $field->name; %>']);
		if($isValid){
			//calls the approprate functions to load an array of <%= $className; %>s from <%= $field->name; %>
			$objArr = <%= tempDriver::capatilize($className); %>::LoadArrayBy<%= tempDriver::capatilize($field->name); %>($_GET['<%= $field->name; %>']);
			$xml = <%= $className; %>XDriver::arrayToXML($objArr);
		}

	break;
	<% } %>
	default:
		throw new Exception("No defined action or action not allowed");
	break;
	
}
	header("Expires: Mon, 26 Jul 1997 05:00:00 GMT" ); 
	header("Last-Modified: " . gmdate( "D, d M Y H:i:s" ) . "GMT" ); 
	header("Cache-Control: no-cache, must-revalidate" ); 
	header("Pragma: no-cache" );
	header("Content-Type: text/xml; charset=utf-8");
	
	echo $xml;

?>